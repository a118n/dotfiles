#! /usr/bin/env ruby

require 'colorize'
require 'nokogiri'
require 'open-uri'

def show(rate)
  print "\n[#{rate[2]}] ".blue
  puts "Selling: #{rate[4].magenta} | Buying: #{rate[3].yellow}"
end

page = Nokogiri::HTML(open("https://connect.raiffeisen.ru/rba/show-rates.do"))

data = page.css("table.formWrapperTable.ratesWrapper.curentCurrency td.odd,
                 table.formWrapperTable.ratesWrapper.curentCurrency td.even")

rates = data.each_with_object([]) { |i, a| a << i.text.strip }.each_slice(5)
                                                              .to_a

if %w(-a --all).include? ARGV[0]
  rates = rates.take(10)
elsif ARGV[0]
  puts "\nGet exchange rates from Raiffeisen Connect\n".blue
  puts "Usage:".yellow
  puts "    rates           | Get current rates for USD, EUR, GBP".green
  puts "    rates -a(--all) | Get all rates".green
  exit
else
  rates = rates.values_at(0,1,3)
end

rates.each { |rate| show(rate) }
